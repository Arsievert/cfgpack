# Fleet Management Gateway — Schema v3
# Firmware upgrade from v2:
#   - Connection timeout WIDENED: tout u16 -> u32 (idx 17)
#   - Geofence radius WIDENED: gf0rd/gf1rd u16 -> u32 (idx 44,47)
#   - REMOVED: gf0en (idx 43), gf1en (idx 46) — merged into geofence flags
#   - NEW: OTA update config, telemetry endpoint, geofence flags, trip ID
#   - Total: 38 entries (12 fstr + 8 str = 20 string entries, 18 numeric)
fleet_v3 3

# ── Vehicle identity (KEPT) ──────────────────────────────────────────────────
1   vid    u32   0            # Vehicle ID
2   vname  str   "truck-01"   # Vehicle display name
3   vtype  fstr  "cargo"      # Vehicle type code
4   plate  fstr  "ABC123"     # License plate
5   drv    str   "unassigned"  # Current driver name
6   drvid  str   NIL           # Driver ID badge number
7   fleet  fstr  "default"     # Fleet group name
8   depot  str   "main-yard"   # Home depot/base name

# ── GPS configuration (KEPT from v2) ────────────────────────────────────────
9   gpsrt  u32   5000          # GPS report interval (ms)
10  gpsen  u8    1             # GPS enable
12  hdop   f32   2.5           # Max HDOP threshold

# ── Network / server (WIDENED: tout u16->u32) ────────────────────────────────
13  srvh   str   "fleet.example.com"  # Server hostname
14  srvp   u16   8443                  # Server port
15  apik   str   NIL                   # API key
16  tls    u8    1                     # TLS enable
17  tout   u32   30000                 # Connection timeout — widened for long-poll
18  retry  u8    3                     # Max retries
19  proto  fstr  "mqtt"                # Protocol

# ── Diagnostics (KEPT from v2) ───────────────────────────────────────────────
25  obdrt  u32   10000         # OBD poll interval (ms)
26  logfn  str   "diag.log"    # Diagnostic log filename
27  loglv  u8    2             # Log level

# ── Device identity (KEPT) ───────────────────────────────────────────────────
28  dname  fstr  "gw-001"      # Gateway device name
29  dser   str   NIL           # Device serial number
30  fwver  fstr  "3.0.0"       # Firmware version
31  hwver  fstr  "rev-b"       # Hardware revision
32  mfg    str   "acme-iot"    # Manufacturer name

# ── Driver extended info (KEPT from v2) ──────────────────────────────────────
40  dph    str   NIL           # Driver phone number
41  dlic   fstr  NIL           # Driver license class

# ── Geofence zones (WIDENED: radius u16->u32, enables REMOVED) ──────────────
42  gf0nm  str   "warehouse"   # Geofence 0 name
# INDEX 43 (gf0en) REMOVED — merged into gfflg
44  gf0rd  u32   500           # Geofence 0 radius (meters) — widened
45  gf1nm  str   "hq-campus"   # Geofence 1 name
# INDEX 46 (gf1en) REMOVED — merged into gfflg
47  gf1rd  u32   1000          # Geofence 1 radius (meters) — widened

# ── MQTT topics (KEPT from v2) ──────────────────────────────────────────────
50  mtpos  fstr  "pos"         # MQTT topic suffix: position
51  mtalr  fstr  "alert"       # MQTT topic suffix: alerts
52  mtdg   fstr  "diag"        # MQTT topic suffix: diagnostics

# ── Alert thresholds (KEPT at v2 indices) ────────────────────────────────────
60  aspd   u16   120           # Speed alert threshold (km/h)
61  aidle  u16   300           # Idle time alert (seconds)
62  atmp   i8    -20           # Low temp alert (degrees C)
63  afuel  u8    15            # Low fuel alert (percent)

# ── NEW: Geofence flags ─────────────────────────────────────────────────────
70  gfflg  u8    3             # Geofence enable bitmask (bit0=gf0, bit1=gf1)

# ── NEW: OTA update config ──────────────────────────────────────────────────
71  otaen  u8    1             # OTA enable
72  otaur  str   "ota.example.com/fw"  # OTA server URL
73  otacr  u32   0             # OTA expected CRC32
74  otaiv  u16   3600          # OTA check interval (seconds)

# ── NEW: Telemetry endpoint ─────────────────────────────────────────────────
75  telep  str   "telemetry.example.com"  # Telemetry endpoint
76  telfm  fstr  "proto"       # Telemetry format (proto/json/cbor)

# ── NEW: Trip tracking ──────────────────────────────────────────────────────
77  trpid  fstr  NIL           # Current trip ID
78  trpen  u8    1             # Trip tracking enable
